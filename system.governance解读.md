#system合约

##system.governance.cpp

对函数进行介绍

###gocstake()

**功能**：进行抵押，在goc中可以通过抵押goc成为gn结点，从而提出提案

传入参数 account_name payer 

**过程：**

首先进行验证，获取当前时间，以及可以抵押的最大限度-10e。

然后在用户资源表中查找当前用户的用户资源，如果没有找到，则为该payer创建用户资源表；如果找到了，则判断是否有足够的资源可以抵押。

如果可以抵押，把goc抵押到gstake账户。



### gocunstake()

**功能：**赎回抵押的goc

**过程：**

验证权限，获取当前时间，判断是否非法输入，以及是否能够赎回

在可以的情况下，首先修改用户资源表中的对应数据项，然后调用内部的action把goc从系统账户(gstake)中取回。



### gocnewprop()

**功能：**提出一个提案

**过程：**

验证权限，获取当前时间，判断是否为非法输入，然后判断缴纳费用的token是否为支持的类型，以及数量是否足够

调用内部action,把提案的费用从提出提案的账户转到系统的储蓄账户(saving),并赋予该提案一个唯一的id

调用emplace函数，创建该提案的详细内容，初始化提案的生成日期，票数。

返回proposal的ID

**关于proposal**：

Proposal是goc中特有的一种治理模式，用户可以支付一定的费用，提出一个proposal，维持三天，然后交由gn节点进行投票(耗时七天)，gn节点投票通过后，交由bp节点进行最终投票(耗时七天)，决定是否执行。                                                          还有另一种目前仅为测试的的proposal类型，bp节点和gn节点共同投票。



### gocupprop()

**功能：**更新提案的内容

**过程：**

验证权限，获取当前时间，判断是否为非法输入，然后判断该id是否有对应的proposal，是否已经过了修改时间(proposal提出的三天内才可以进行修改，三天后要进行投票)，判断修改人是否为proposal的提出者(只有他可以修改提案的内容)

验证通过后，对proposal的内容进行修改



### gocsetpstage()

**功能：**设置提案的状态

**参数输入**：

‘‘’ const account_name owner, uint64_t id, uint16_t stage, time start_time ‘’’

分别为拥有者的名称，提案的id，期望的阶段，该阶段的开始时间

一个提案的状态共有(0-4)五个阶段，分别为创建阶段，普通投票阶段，bp投票阶段，结束阶段，生效阶段。

**过程**：

验证权限，判断是否为非法输入，然后判断是否存在对应的proposal，是否为所有者进行操作，提案是否已经生效(已经生效的提案无法修改其状态)。

根据输入的阶段，修改提案对应的时间参数，对于当前阶段之前的阶段，时间间隔统一修改为一小时。

### gocvote()

**功能：**所用节点(包括bp节点)对提案进行投票

**输入参数：**voter,pid,yea

**过程：**

1.验证投票者，验证提案是否存在，然后判断提案的状态，是否可以投票

2.读取该投票者的用户资源表，查看其抵押的goc是否达到投票所需的数量

3.读取该提案的票数表，然后在表下查找，看该投票者是否已经投过票，如果投过票，则检查是否与之前的结果一致，若不同对旧的投票状态进行更新，然后修改该提案的总票数并返回提示，若相同则跳过并返回提示；如果投票者之前没有投过票就创建一个新的票，并修改该提案的总票数。

4.最后检查一下，stake的冻结时间是否早于bp节点投票结束时间，如果是则修改到保持一致。



### gocbpvote()

**功能：**bp节点针对提案进行投票(记反对票)

**输入参数：**voter,pid,yea

**过程：**

1.验证投票者，获取当前时间，检查提案是否存在，然后检查该投票者是否为bp节点，该阶段只有bp节点可以投票，且不需要抵押goc

2.查看提案的bp阶段投票的起止时间，判断当前时间是否在其区间内；

3.之后与普通投票类似，记录bp节点的投票结果







**功能：**

**输入参数：**

**过程：**